BootStrap: docker
From: nvidia/cuda:10.2-cudnn8-devel-ubuntu18.04

%post
    apt-get -y update
    export DEBIAN_FRONTEND=noninteractive
    export FORCE_UNSAFE_CONFIGURE=1

    apt-get install -y --no-install-recommends \
       autoconf \
       build-essential \
       ca-certificates \
       coreutils \
       curl \
       file \
       git \
       gfortran \
       python \
       unzip \
       vim \
       ssh \
       time \
       gdb \
       python3-distutils

    curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | bash && apt-get install git-lfs

    export SPACK_ROOT=/usr/local

    curl -s -L https://api.github.com/repos/platoengine/spack/tarball | tar xzC $SPACK_ROOT --strip 1

    spack install platoanalyze+cuda+mpmd+python+geometry+esp @develop ^nvcc-wrapper compute_capability=70 ^openmpi@4.0.2

    eval `spack load --sh platoanalyze`
